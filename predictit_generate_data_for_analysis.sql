

--export predictIt data for matching with voter/consumer data
select a.AccountID, firstname, lastname, Address1 + case when Address2 >'' then ' '+Address2 else '' end as address  ,
a.city, a.statecode, a.postalcode, birthdateday, birthdatemonth, birthdateyear,
a.deposits,
a.accountbalance,
a.Withdrawals,
Invested,
[Shares Owned] as numshares,
riskamount,
profit,
loss,
a.lastlogin 
from vwAccountsDetail a join currentdetail_20231208
b on a.accountid = b.accountid
where firstname >'' and lastname >'' and PostalCode >'' and a.idverified >'' 
and birthdateday >0 and birthdatemonth>0 and birthdateyear >0
--304757


select * from predictitdata_20240205

--getting a list of all data points common to all state voter dbs
create table field_lengths (dataset varchar(20), fieldname varchar(50), type varchar(50), length int)

declare @state varchar(2)
declare @sqlstring varchar(8000)

declare c1 cursor for select distinct state from prod_dates
order by state
open c1 
fetch next from c1 into @state
while @@fetch_status = 0

begin

select @sqlstring = ' insert into field_lengths
select b.name, a.name, c.name, a.length from '+@state+'_voters..syscolumns a join '+@state+'_voters..sysobjects b
on a.id =b.id join '+@state+'_voters..systypes c on c.xtype = a.xtype
 where b.name = '''+@state+'_voters'''
exec( @sqlstring)
 
 fetch next from c1 into @state
 end
 close c1 
 deallocate c1

select distinct fieldname from field_lengths where fieldname in (select fieldname from field_lengths
group by fieldname having count(*) = 51)

---ran predictitdata_20240205 thru ncoa for address standardization

select * into predictitdata_20240205 from predictitdata_20240205


alter table predictitdata_20240205 drop column batch_id

use --db name removed for security


alter table predictitdata_20240205 alter column address varchar(100)
alter table predictitdata_20240205 alter column city varchar(100)
alter table predictitdata_20240205 alter column statecode varchar(100)
alter table predictitdata_20240205 alter column postalcode varchar(100)

select count(*) from predictitdata_20240205_batch where coa_address >''

select * from predictitdata_20240205_batch


select 
AccountID,
firstname,
lastname,
case coa_address when '' then std_addr else coa_address end as address ,
case coa_city when '' then std_city else coa_city end as city,
case coa_state when '' then statecode else coa_state end as state,
case coa_zip when '' then std_zip else coa_zip end as zip,
case coa_zip4 when '' then std_zip4 else coa_zip4 end as zip4,
postalcode,
birthdateday,
birthdatemonth,
birthdateyear,
deposits,
accountbalance,
Withdrawals,
Invested,
numshares,
riskamount,
profit,
loss,
lastlogin
into predictitdata_20240205_for_matching from predictitdata_20240205 a join predictitdata_20240205_batch b
on a.batch_id =b.batch_id
--(304757 rows affected)

select * from predictitdata_20240205_for_matching

alter table predictitdata_20240205_for_matching drop column postalcode

alter table predictitdata_20240205_for_matching add  rowid int identity(1,1)

select top 0 rowid,
ABSENTEE,
AD_1824FEM,
AD_1824MAL,
AD_1824UNK,
AD_2534FEM,
AD_2534MAL,
AD_2534UNK,
AD_3544FEM,
AD_3544MAL,
AD_3544UNK,
AD_4554FEM,
AD_4554MAL,
AD_4554UNK,
AD_5564FEM,
AD_5564MAL,
AD_5564UNK,
AD_6574FEM,
AD_6574MAL,
AD_6574UNK,
AD_75UPFEM,
AD_75UPMAL,
AD_75UPUNK,
AFAMPROFLS,
AGE,
AGE_IND,
AI_County_Name,
AIRCOND,
ALUMNI_INDUSTRY,
ALUMNI_SALARY_EST,
APP_CHILD,
APP_MENBIG,
APP_MENS,
APP_TODDLR,
APP_WOMEN,
APP_WOMENS,
APP_WOMPET,
APP_WOMPLS,
APP_YNGMEN,
ART_ANTIQ,
ART_ART,
ARTS,
ASSMLCODE,
AUTO_BODY,
AUTO_COUNT,
AUTO_COUNTRY,
AUTO_ECO,
AUTO_FUEL_TYPE,
AUTO_IMPORT_DOMESTIC,
AUTO_LUXURY,
AUTO_MAKE,
AUTO_MODEL,
AUTO_MSRP,
AUTO_TRANS_TYPE,
AUTO_TYPE,
AUTO_YEAR,
AUTOACCES,
AUTOWORK,
AVIATION,
BEAUTY,
BKSMAG_BKS,
BKSMAG_MAG,
BKSMS_AUD,
BNKCRD_HH,
BNKCRD_HLD,
BOATING,
BROADERLIV,
BUS_OWNER,
CAMPHIKING,
CARD_PREM,
CARD_UNK,
CARDUSER,
CAREER,
CAREERIMP,
CATOWNER,
CENSUS_BLK,
CENSUS_ST,
CH_0002FEM,
CH_0002MAL,
CH_0002UNK,
CH_0305FEM,
CH_0305MAL,
CH_0305UNK,
CH_0610FEM,
CH_0610MAL,
CH_0610UNK,
CH_1115FEM,
CH_1115MAL,
CH_1115UNK,
CH_1617FEM,
CH_1617MAL,
CH_1617UNK,
CH_BABYCAR,
CH_GEN,
CH_INTER,
CH_SCHL,
CH_TOYS,
CHRISTFAM,
CNS_MEDINC,
CNSUS_PCTA,
CNSUS_PCTB,
CNSUS_PCTH,
CNSUS_PCTI,
CNSUS_PCTM,
CNSUS_PCTO,
CNSUS_PCTP,
CNSUS_PCTW,
COL_ANTIQ,
COL_ARTS,
COL_AVID,
COL_COIN,
COL_GEN,
COL_GROUP,
COL_MOVIE,
COL_SPORT,
COL_STAMP,
COMMCHAR,
COMMONLIVG,
COMPHOMOFC,
COMPUTERS,
CONG_DIST,
COOK_GEN,
COOK_GOUR,
COOK_GROUP,
COUNTY_ST,
COUNTY_TYPE,
CRAFTS,
CRD_AMEXGO,
CRD_AMEXRG,
CRD_DISCGO,
CRD_DISCRG,
CRD_GASGO,
CRD_GASRG,
CRD_MASGO,
CRD_MASRG,
CRD_RANGE,
CREDRATE,
CULARTLIV,
CURRAFFAIR,
DEPTSTCRD,
DIETING,
DIYLIV,
DMA_Code,
DOGOWNER,
DON_ANML,
DON_ARTCUL,
DON_CHARIT,
DON_CHILD,
DON_ENVIR,
DON_ENVWLD,
DON_HEALTH,
DON_INTAID,
DON_OTHER,
DON_POLCONS,
DON_POLIT,
DON_POLLIB,
DON_RELIG,
DON_VET,
DONATION,
DVDVIDEO,
DWELLTYPE,
EDU_ONLINE,
EDUCATION,
ELEC_GROUP,
ELEC_HOMOF,
ELEC_TVVID,
EQUESTRIAN,
ETHNIC_INFER,
EXER_AERO,
EXER_GROUP,
EXER_RUN,
EXER_WALK,
FISHING,
FOOD_WINE,
FOODSNAT,
FUEL,
FUND_POLIT,
GAM_BOARD,
GAM_CASINO,
GAM_COMP,
GAM_VID,
GAMING,
GARDENER,
GARDENING,
GASCARDHLD,
GENDER_MIX,
GENERATION,
GOLF,
GRANDCHLD,
HEALTHBEAU,
HEATHMED,
HH_NUMGEN,
HH_SENIOR,
HH_SIZE,
HH_VETERAN,
HH_YOUNGAD,
HIGHBROW,
HIGHENDAPP,
HISTMIL,
HITECHLIV,
HOH_FLAG,
HOME_BIZ,
HOME_DECOR,
HOME_SEQ,
HOMEGARDEN,
HOMEIMP,
HOMEIMPDIY,
HOMEIMPGRP,
HOMELIV,
HOMEMKTVAL,
HOMEOFFICE,
HOMEOWNER,
HOMEOWNRNT,
HOUSEPLANT,
HSPCNTRYCD,
HUNTING,
HUNTSHOOT,
INCOMESTHH,
INV_ACTIVE,
INV_ESTPRP,
INV_FINGRP,
INV_FORGN,
INV_PERSON,
INV_REAL,
INV_STOCKS,
JEWELRY,
LANGUAGE,
LENGTH_RES,
LFST_COLL,
LFST_HOBB,
LIFESTAGE_CLUSTER,
LOANTOVAL,
LUGGAGE,
MAGAZINE,
MAIL_DONOR,
MAILORDBUY,
MAILORDRSP,
MEDHOMEVAL,
MEMBERSHIP,
MILIWEAPN,
MONEYSEEK,
MOTORCYCLE,
MOVEDATE,
MOVMUSGRP,
MRTLSTATUS,
MUS_AVID,
MUS_COLLEC,
MUS_HOMEST,
MUS_INSTR,
MUS_PLAYER,
NASCAR,
NETWORTH,
NUMADLT,
NUMCHILD,
NUMLINCRED,
OCCDETAIL,
OCCDETAIL_DESC,
OCCUPATION,
ONLPUR_IND,
OUTDRGROUP,
PARENTING,
PARTY_CODE,
PARTY_MIX,
PASSPROSVAL,
PERSONS_HH,
PET_OTHER,
PETS,
PHOTOGRAPH,
PHOTOVIDEO,
POOL,
PRESENCHLD,
PREVIOUS_PARTY,
PRFL_2NDAMEND,
PRFL_ACTIVE_MIL,
PRFL_AMZN_PRIME,
PRFL_ANML_RIGHTS,
PRFL_BIDEN_SUPPORT,
PRFL_BLM_SUPPORT,
PRFL_BORDER_SECURITY,
PRFL_CHOICELIFE,
PRFL_CLINTON_SUPPORT,
PRFL_CONSERVATIVE_NEWS,
PRFL_EDUCATION,
PRFL_ENVIRONMENT,
PRFL_EVANGELICAL,
PRFL_FENCE_SITTER,
PRFL_GUN_CONTROL,
PRFL_HEALTHCARE,
PRFL_HEALTHCARE_REFORM,
PRFL_IMMIGRATION_REFORM,
PRFL_INFLUENCER,
PRFL_INSURANCE,
PRFL_LABOR,
PRFL_LGBT_SUPPORT,
PRFL_LIBERAL_NEWS,
PRFL_MARIJUANA_REFORM,
PRFL_MARRIAGE_EQUALITY,
PRFL_METOO_SUPPORT,
PRFL_MIL_SUPPORT,
PRFL_MINWAGE,
PRFL_OBAMA,
PRFL_PERSUADABLE_VOTER,
PRFL_POLITICAL_IDEOLOGY,
PRFL_SANDERS_SUPPORT,
PRFL_TAXES,
PRFL_TEACHERS_UNION,
PRFL_TEAPARTY,
PRFL_TRUMP_SUPPORT,
PRFL_VETERAN,
PROFLIV,
Property_Type,
RD_AUDIO,
RD_FINNEWS,
RD_GEN,
RD_GRP,
RD_RELIG,
RD_SCIFI,
READ_MAG,
REGION,
RELIGINSP,
RELIGION,
SCISPACE,
SCUBADIVER,
SELFIMP,
SEWER,
SEWING,
SEX,
SINGPARENT,
SMOKING,
SNOWSKI,
SPEC_AUTO,
SPEC_BASE,
SPEC_BASK,
SPEC_FOOT,
SPEC_HOCK,
SPEC_SOCC,
SPEC_TVSP,
SPORTGRP,
SPORTLEIS,
SPORTLIV,
ST_LO_HOUS,
ST_UP_HOUS,
STATE,
STATECONT,
STATUS,
SWEEPSTAKE,
TELECOM,
TENNIS,
THEATER,
TIMEZONE,
TOD_GOV_D_2012,
TOD_GOV_D_2014,
TOD_GOV_D_2016,
TOD_GOV_D_2018,
TOD_GOV_D_2020,
TOD_GOV_DIFF_2012,
TOD_GOV_DIFF_2014,
TOD_GOV_DIFF_2016,
TOD_GOV_DIFF_2018,
TOD_GOV_DIFF_2020,
TOD_GOV_O_2014,
TOD_GOV_O_2016,
TOD_GOV_O_2018,
TOD_GOV_R_2012,
TOD_GOV_R_2014,
TOD_GOV_R_2016,
TOD_GOV_R_2018,
TOD_GOV_R_2020,
TOD_PRES_D_2012,
TOD_PRES_D_2016,
TOD_PRES_D_2016_PREC,
TOD_PRES_D_2020,
TOD_PRES_D_2020_PREC,
TOD_PRES_DIFF_2012,
TOD_PRES_DIFF_2016,
TOD_PRES_DIFF_2016_PREC,
TOD_PRES_DIFF_2020,
TOD_PRES_DIFF_2020_PREC,
TOD_PRES_O_2012,
TOD_PRES_O_2016,
TOD_PRES_O_2016_PREC,
TOD_PRES_O_2020,
TOD_PRES_O_2020_PREC,
TOD_PRES_R_2012,
TOD_PRES_R_2016,
TOD_PRES_R_2016_PREC,
TOD_PRES_R_2020,
TOD_PRES_R_2020_PREC,
TOD_SEN_D_2012,
TOD_SEN_D_2014,
TOD_SEN_D_2016,
TOD_SEN_D_2018,
TOD_SEN_D_2020,
TOD_SEN_DIFF_2012,
TOD_SEN_DIFF_2014,
TOD_SEN_DIFF_2016,
TOD_SEN_DIFF_2018,
TOD_SEN_DIFF_2020,
TOD_SEN_O_2012,
TOD_SEN_O_2014,
TOD_SEN_O_2016,
TOD_SEN_O_2018,
TOD_SEN_O_2020,
TOD_SEN_R_2012,
TOD_SEN_R_2014,
TOD_SEN_R_2016,
TOD_SEN_R_2018,
TOD_SEN_R_2020,
TRAIL_CNT,
TRAVEL,
TRV_CRDHLD,
TRV_CRUISE,
TRV_DOMES,
TRV_INTL,
TRVLGROUP,
TV_CABLE,
TV_SAT,
UPSCALLIVE,
VALGENMER,
VISAGOLD,
VISAREGULR,
VOT_PREF,
VOTER_CNT,
VOTER_TRLR,
VP_GEN,
VP_OTH,
VP_PPP,
VP_PRI,
VTR_GEN00,
VTR_GEN01,
VTR_GEN02,
VTR_GEN03,
VTR_GEN04,
VTR_GEN05,
VTR_GEN06,
VTR_GEN07,
VTR_GEN08,
VTR_GEN09,
VTR_GEN10,
VTR_GEN11,
VTR_GEN12,
VTR_GEN13,
VTR_GEN14,
VTR_GEN15,
VTR_GEN16,
VTR_GEN17,
VTR_GEN18,
VTR_GEN19,
VTR_GEN20,
VTR_GEN21,
VTR_GEN22,
VTR_GEN23,
VTR_GEN24,
VTR_GEN84,
VTR_GEN85,
VTR_GEN86,
VTR_GEN87,
VTR_GEN88,
VTR_GEN89,
VTR_GEN90,
VTR_GEN91,
VTR_GEN92,
VTR_GEN93,
VTR_GEN94,
VTR_GEN95,
VTR_GEN96,
VTR_GEN97,
VTR_GEN98,
VTR_GEN99,
VTR_OTH00,
VTR_OTH01,
VTR_OTH02,
VTR_OTH03,
VTR_OTH04,
VTR_OTH05,
VTR_OTH06,
VTR_OTH07,
VTR_OTH08,
VTR_OTH09,
VTR_OTH10,
VTR_OTH11,
VTR_OTH12,
VTR_OTH13,
VTR_OTH14,
VTR_OTH15,
VTR_OTH16,
VTR_OTH17,
VTR_OTH18,
VTR_OTH19,
VTR_OTH20,
VTR_OTH21,
VTR_OTH22,
VTR_OTH23,
VTR_OTH24,
VTR_OTH84,
VTR_OTH85,
VTR_OTH86,
VTR_OTH87,
VTR_OTH88,
VTR_OTH89,
VTR_OTH90,
VTR_OTH91,
VTR_OTH92,
VTR_OTH93,
VTR_OTH94,
VTR_OTH95,
VTR_OTH96,
VTR_OTH97,
VTR_OTH98,
VTR_OTH99,
VTR_PPP00,
VTR_PPP04,
VTR_PPP08,
VTR_PPP12,
VTR_PPP16,
VTR_PPP20,
VTR_PPP24,
VTR_PPP84,
VTR_PPP88,
VTR_PPP92,
VTR_PPP96,
VTR_PRI00,
VTR_PRI01,
VTR_PRI02,
VTR_PRI03,
VTR_PRI04,
VTR_PRI05,
VTR_PRI06,
VTR_PRI07,
VTR_PRI08,
VTR_PRI09,
VTR_PRI10,
VTR_PRI11,
VTR_PRI12,
VTR_PRI13,
VTR_PRI14,
VTR_PRI15,
VTR_PRI16,
VTR_PRI17,
VTR_PRI18,
VTR_PRI19,
VTR_PRI20,
VTR_PRI21,
VTR_PRI22,
VTR_PRI23,
VTR_PRI24,
VTR_PRI84,
VTR_PRI85,
VTR_PRI86,
VTR_PRI87,
VTR_PRI88,
VTR_PRI89,
VTR_PRI90,
VTR_PRI91,
VTR_PRI92,
VTR_PRI93,
VTR_PRI94,
VTR_PRI95,
VTR_PRI96,
VTR_PRI97,
VTR_PRI98,
VTR_PRI99,
WATER,
WEALTH,
WOODWORK,
WORKWOMAN,
YEARBUILT,
ZIP	
into predictit_voter_match from ak_voters..ak_voters with (nolock)
--create a layout to use

select * from predictitdata_20240205_for_matching

select * from predictit_voter_match

--two match levels , one using the original address and the other using the changed address from NCOA if present.
declare @state varchar(2)
declare @sqlstring varchar(8000)

declare c1 cursor for select distinct state from prod_dates with (nolock) where state <> 'vi'
order by state
open c1
fetch next from c1 into @state

while @@fetch_status = 0

begin

select @sqlstring = 'insert into predictit_voter_match
select a.rowid,ABSENTEE,AD_1824FEM,AD_1824MAL,AD_1824UNK,AD_2534FEM,AD_2534MAL,AD_2534UNK,
AD_3544FEM,AD_3544MAL,AD_3544UNK,AD_4554FEM,AD_4554MAL,AD_4554UNK,AD_5564FEM,AD_5564MAL,
AD_5564UNK,AD_6574FEM,AD_6574MAL,AD_6574UNK,AD_75UPFEM,AD_75UPMAL,AD_75UPUNK,AFAMPROFLS,
AGE,AGE_IND,AI_County_Name,AIRCOND,ALUMNI_INDUSTRY,ALUMNI_SALARY_EST,APP_CHILD,APP_MENBIG,
APP_MENS,APP_TODDLR,APP_WOMEN,APP_WOMENS,APP_WOMPET,APP_WOMPLS,APP_YNGMEN,ART_ANTIQ,ART_ART,
ARTS,ASSMLCODE,AUTO_BODY,AUTO_COUNT,AUTO_COUNTRY,AUTO_ECO,AUTO_FUEL_TYPE,AUTO_IMPORT_DOMESTIC,
AUTO_LUXURY,AUTO_MAKE,AUTO_MODEL,AUTO_MSRP,AUTO_TRANS_TYPE,AUTO_TYPE,AUTO_YEAR,AUTOACCES,AUTOWORK,
AVIATION,BEAUTY,BKSMAG_BKS,BKSMAG_MAG,BKSMS_AUD,BNKCRD_HH,BNKCRD_HLD,BOATING,BROADERLIV,BUS_OWNER,
CAMPHIKING,CARD_PREM,CARD_UNK,CARDUSER,CAREER,CAREERIMP,CATOWNER,CENSUS_BLK,CENSUS_ST,CH_0002FEM,
CH_0002MAL,CH_0002UNK,CH_0305FEM,CH_0305MAL,CH_0305UNK,CH_0610FEM,CH_0610MAL,CH_0610UNK,CH_1115FEM,
CH_1115MAL,CH_1115UNK,CH_1617FEM,CH_1617MAL,CH_1617UNK,CH_BABYCAR,CH_GEN,CH_INTER,CH_SCHL,CH_TOYS,
CHRISTFAM,CNS_MEDINC,CNSUS_PCTA,CNSUS_PCTB,CNSUS_PCTH,CNSUS_PCTI,CNSUS_PCTM,CNSUS_PCTO,CNSUS_PCTP,
CNSUS_PCTW,COL_ANTIQ,COL_ARTS,COL_AVID,COL_COIN,COL_GEN,COL_GROUP,COL_MOVIE,COL_SPORT,COL_STAMP,
COMMCHAR,COMMONLIVG,COMPHOMOFC,COMPUTERS,CONG_DIST,COOK_GEN,COOK_GOUR,COOK_GROUP,COUNTY_ST,COUNTY_TYPE,
CRAFTS,CRD_AMEXGO,CRD_AMEXRG,CRD_DISCGO,CRD_DISCRG,CRD_GASGO,CRD_GASRG,CRD_MASGO,CRD_MASRG,CRD_RANGE,
CREDRATE,CULARTLIV,CURRAFFAIR,DEPTSTCRD,DIETING,DIYLIV,DMA_Code,DOGOWNER,DON_ANML,DON_ARTCUL,
DON_CHARIT,DON_CHILD,DON_ENVIR,DON_ENVWLD,DON_HEALTH,DON_INTAID,DON_OTHER,DON_POLCONS,DON_POLIT,
DON_POLLIB,DON_RELIG,DON_VET,DONATION,DVDVIDEO,DWELLTYPE,EDU_ONLINE,EDUCATION,ELEC_GROUP,
ELEC_HOMOF,ELEC_TVVID,EQUESTRIAN,ETHNIC_INFER,EXER_AERO,EXER_GROUP,EXER_RUN,EXER_WALK,FISHING,
FOOD_WINE,FOODSNAT,FUEL,FUND_POLIT,GAM_BOARD,GAM_CASINO,GAM_COMP,GAM_VID,GAMING,GARDENER,GARDENING,
GASCARDHLD,GENDER_MIX,GENERATION,GOLF,GRANDCHLD,HEALTHBEAU,HEATHMED,HH_NUMGEN,HH_SENIOR,HH_SIZE,
HH_VETERAN,HH_YOUNGAD,HIGHBROW,HIGHENDAPP,HISTMIL,HITECHLIV,HOH_FLAG,HOME_BIZ,HOME_DECOR,
HOME_SEQ,HOMEGARDEN,HOMEIMP,HOMEIMPDIY,HOMEIMPGRP,HOMELIV,HOMEMKTVAL,HOMEOFFICE,HOMEOWNER,
HOMEOWNRNT,HOUSEPLANT,HSPCNTRYCD,HUNTING,HUNTSHOOT,INCOMESTHH,INV_ACTIVE,INV_ESTPRP,INV_FINGRP,
INV_FORGN,
INV_PERSON,
INV_REAL,
INV_STOCKS,
JEWELRY,
LANGUAGE,
LENGTH_RES,
LFST_COLL,
LFST_HOBB,
LIFESTAGE_CLUSTER,
LOANTOVAL,
LUGGAGE,
MAGAZINE,
MAIL_DONOR,
MAILORDBUY,
MAILORDRSP,
MEDHOMEVAL,
MEMBERSHIP,
MILIWEAPN,
MONEYSEEK,
MOTORCYCLE,
MOVEDATE,
MOVMUSGRP,
MRTLSTATUS,
MUS_AVID,
MUS_COLLEC,
MUS_HOMEST,
MUS_INSTR,
MUS_PLAYER,
NASCAR,
NETWORTH,
NUMADLT,
NUMCHILD,
NUMLINCRED,
OCCDETAIL,
OCCDETAIL_DESC,
OCCUPATION,
ONLPUR_IND,
OUTDRGROUP,
PARENTING,
PARTY_CODE,
PARTY_MIX,
PASSPROSVAL,
PERSONS_HH,
PET_OTHER,
PETS,
PHOTOGRAPH,
PHOTOVIDEO,
POOL,
PRESENCHLD,
PREVIOUS_PARTY,
PRFL_2NDAMEND,
PRFL_ACTIVE_MIL,
PRFL_AMZN_PRIME,
PRFL_ANML_RIGHTS,
PRFL_BIDEN_SUPPORT,
PRFL_BLM_SUPPORT,
PRFL_BORDER_SECURITY,
PRFL_CHOICELIFE,
PRFL_CLINTON_SUPPORT,
PRFL_CONSERVATIVE_NEWS,
PRFL_EDUCATION,
PRFL_ENVIRONMENT,
PRFL_EVANGELICAL,
PRFL_FENCE_SITTER,
PRFL_GUN_CONTROL,
PRFL_HEALTHCARE,
PRFL_HEALTHCARE_REFORM,
PRFL_IMMIGRATION_REFORM,
PRFL_INFLUENCER,
PRFL_INSURANCE,
PRFL_LABOR,
PRFL_LGBT_SUPPORT,
PRFL_LIBERAL_NEWS,
PRFL_MARIJUANA_REFORM,
PRFL_MARRIAGE_EQUALITY,
PRFL_METOO_SUPPORT,
PRFL_MIL_SUPPORT,
PRFL_MINWAGE,
PRFL_OBAMA,
PRFL_PERSUADABLE_VOTER,
PRFL_POLITICAL_IDEOLOGY,
PRFL_SANDERS_SUPPORT,
PRFL_TAXES,
PRFL_TEACHERS_UNION,
PRFL_TEAPARTY,
PRFL_TRUMP_SUPPORT,
PRFL_VETERAN,
PROFLIV,
Property_Type,
RD_AUDIO,
RD_FINNEWS,
RD_GEN,
RD_GRP,
RD_RELIG,
RD_SCIFI,
READ_MAG,
REGION,
RELIGINSP,
RELIGION,
SCISPACE,
SCUBADIVER,
SELFIMP,
SEWER,
SEWING,
SEX,
SINGPARENT,
SMOKING,
SNOWSKI,
SPEC_AUTO,
SPEC_BASE,
SPEC_BASK,
SPEC_FOOT,
SPEC_HOCK,
SPEC_SOCC,
SPEC_TVSP,
SPORTGRP,
SPORTLEIS,
SPORTLIV,
ST_LO_HOUS,
ST_UP_HOUS,
b.STATE,
STATECONT,
STATUS,
SWEEPSTAKE,
TELECOM,
TENNIS,
THEATER,
TIMEZONE,
TOD_GOV_D_2012,
TOD_GOV_D_2014,
TOD_GOV_D_2016,
TOD_GOV_D_2018,
TOD_GOV_D_2020,
TOD_GOV_DIFF_2012,
TOD_GOV_DIFF_2014,
TOD_GOV_DIFF_2016,
TOD_GOV_DIFF_2018,
TOD_GOV_DIFF_2020,
TOD_GOV_O_2014,
TOD_GOV_O_2016,
TOD_GOV_O_2018,
TOD_GOV_R_2012,
TOD_GOV_R_2014,
TOD_GOV_R_2016,
TOD_GOV_R_2018,
TOD_GOV_R_2020,
TOD_PRES_D_2012,
TOD_PRES_D_2016,
TOD_PRES_D_2016_PREC,
TOD_PRES_D_2020,
TOD_PRES_D_2020_PREC,
TOD_PRES_DIFF_2012,
TOD_PRES_DIFF_2016,
TOD_PRES_DIFF_2016_PREC,
TOD_PRES_DIFF_2020,
TOD_PRES_DIFF_2020_PREC,
TOD_PRES_O_2012,
TOD_PRES_O_2016,
TOD_PRES_O_2016_PREC,
TOD_PRES_O_2020,
TOD_PRES_O_2020_PREC,
TOD_PRES_R_2012,
TOD_PRES_R_2016,
TOD_PRES_R_2016_PREC,
TOD_PRES_R_2020,
TOD_PRES_R_2020_PREC,
TOD_SEN_D_2012,
TOD_SEN_D_2014,
TOD_SEN_D_2016,
TOD_SEN_D_2018,
TOD_SEN_D_2020,
TOD_SEN_DIFF_2012,
TOD_SEN_DIFF_2014,
TOD_SEN_DIFF_2016,
TOD_SEN_DIFF_2018,
TOD_SEN_DIFF_2020,
TOD_SEN_O_2012,
TOD_SEN_O_2014,
TOD_SEN_O_2016,
TOD_SEN_O_2018,
TOD_SEN_O_2020,
TOD_SEN_R_2012,
TOD_SEN_R_2014,
TOD_SEN_R_2016,
TOD_SEN_R_2018,
TOD_SEN_R_2020,
TRAIL_CNT,
TRAVEL,
TRV_CRDHLD,
TRV_CRUISE,
TRV_DOMES,
TRV_INTL,
TRVLGROUP,
TV_CABLE,
TV_SAT,
UPSCALLIVE,
VALGENMER,
VISAGOLD,
VISAREGULR,
VOT_PREF,
VOTER_CNT,
VOTER_TRLR,
VP_GEN,
VP_OTH,
VP_PPP,
VP_PRI,
VTR_GEN00,
VTR_GEN01,
VTR_GEN02,
VTR_GEN03,
VTR_GEN04,
VTR_GEN05,
VTR_GEN06,
VTR_GEN07,
VTR_GEN08,
VTR_GEN09,
VTR_GEN10,
VTR_GEN11,
VTR_GEN12,
VTR_GEN13,
VTR_GEN14,
VTR_GEN15,
VTR_GEN16,
VTR_GEN17,
VTR_GEN18,
VTR_GEN19,
VTR_GEN20,
VTR_GEN21,
VTR_GEN22,
VTR_GEN23,
VTR_GEN24,
VTR_GEN84,
VTR_GEN85,
VTR_GEN86,
VTR_GEN87,
VTR_GEN88,
VTR_GEN89,
VTR_GEN90,
VTR_GEN91,
VTR_GEN92,
VTR_GEN93,
VTR_GEN94,
VTR_GEN95,
VTR_GEN96,
VTR_GEN97,
VTR_GEN98,
VTR_GEN99,
VTR_OTH00,
VTR_OTH01,
VTR_OTH02,
VTR_OTH03,
VTR_OTH04,
VTR_OTH05,
VTR_OTH06,
VTR_OTH07,
VTR_OTH08,
VTR_OTH09,
VTR_OTH10,
VTR_OTH11,
VTR_OTH12,
VTR_OTH13,
VTR_OTH14,
VTR_OTH15,
VTR_OTH16,
VTR_OTH17,
VTR_OTH18,
VTR_OTH19,
VTR_OTH20,
VTR_OTH21,
VTR_OTH22,
VTR_OTH23,
VTR_OTH24,
VTR_OTH84,
VTR_OTH85,
VTR_OTH86,
VTR_OTH87,
VTR_OTH88,
VTR_OTH89,
VTR_OTH90,
VTR_OTH91,
VTR_OTH92,
VTR_OTH93,
VTR_OTH94,
VTR_OTH95,
VTR_OTH96,
VTR_OTH97,
VTR_OTH98,
VTR_OTH99,
VTR_PPP00,
VTR_PPP04,
VTR_PPP08,
VTR_PPP12,
VTR_PPP16,
VTR_PPP20,
VTR_PPP24,
VTR_PPP84,
VTR_PPP88,
VTR_PPP92,
VTR_PPP96,
VTR_PRI00,
VTR_PRI01,
VTR_PRI02,
VTR_PRI03,
VTR_PRI04,
VTR_PRI05,
VTR_PRI06,
VTR_PRI07,
VTR_PRI08,
VTR_PRI09,
VTR_PRI10,
VTR_PRI11,
VTR_PRI12,
VTR_PRI13,
VTR_PRI14,
VTR_PRI15,
VTR_PRI16,
VTR_PRI17,
VTR_PRI18,
VTR_PRI19,
VTR_PRI20,
VTR_PRI21,
VTR_PRI22,
VTR_PRI23,
VTR_PRI24,
VTR_PRI84,
VTR_PRI85,
VTR_PRI86,
VTR_PRI87,
VTR_PRI88,
VTR_PRI89,
VTR_PRI90,
VTR_PRI91,
VTR_PRI92,
VTR_PRI93,
VTR_PRI94,
VTR_PRI95,
VTR_PRI96,
VTR_PRI97,
VTR_PRI98,
VTR_PRI99,
WATER,
WEALTH,
WOODWORK,
WORKWOMAN,
YEARBUILT,
b.ZIP	from predictitdata_20240205_for_matching a join '+@state+'_voters..'+@state+'_voters b with (nolock)
on a.firstname = b.firstname and a.lastname = b.lastname and a.zip = b.zip and a.zip4 = b.zip4
where a.zip4 >'''' '
exec(@sqlstring)
fetch next from c1 into @state
end 
close c1
deallocate c1


select count(*) from predictit_voter_match --130833
select count(distinct rowid) from predictit_voter_match --127694


declare @state varchar(2)
declare @sqlstring varchar(8000)

declare c1 cursor for select distinct state from prod_dates with (nolock) 
order by state
open c1
fetch next from c1 into @state

while @@fetch_status = 0

begin

select @sqlstring = 'insert into predictit_voter_match
select a.rowid,ABSENTEE,AD_1824FEM,AD_1824MAL,AD_1824UNK,AD_2534FEM,AD_2534MAL,AD_2534UNK,
AD_3544FEM,AD_3544MAL,AD_3544UNK,AD_4554FEM,AD_4554MAL,AD_4554UNK,AD_5564FEM,AD_5564MAL,
AD_5564UNK,AD_6574FEM,AD_6574MAL,AD_6574UNK,AD_75UPFEM,AD_75UPMAL,AD_75UPUNK,AFAMPROFLS,
AGE,AGE_IND,AI_County_Name,AIRCOND,ALUMNI_INDUSTRY,ALUMNI_SALARY_EST,APP_CHILD,APP_MENBIG,
APP_MENS,APP_TODDLR,APP_WOMEN,APP_WOMENS,APP_WOMPET,APP_WOMPLS,APP_YNGMEN,ART_ANTIQ,ART_ART,
ARTS,ASSMLCODE,AUTO_BODY,AUTO_COUNT,AUTO_COUNTRY,AUTO_ECO,AUTO_FUEL_TYPE,AUTO_IMPORT_DOMESTIC,
AUTO_LUXURY,AUTO_MAKE,AUTO_MODEL,AUTO_MSRP,AUTO_TRANS_TYPE,AUTO_TYPE,AUTO_YEAR,AUTOACCES,AUTOWORK,
AVIATION,BEAUTY,BKSMAG_BKS,BKSMAG_MAG,BKSMS_AUD,BNKCRD_HH,BNKCRD_HLD,BOATING,BROADERLIV,BUS_OWNER,
CAMPHIKING,CARD_PREM,CARD_UNK,CARDUSER,CAREER,CAREERIMP,CATOWNER,CENSUS_BLK,CENSUS_ST,CH_0002FEM,
CH_0002MAL,CH_0002UNK,CH_0305FEM,CH_0305MAL,CH_0305UNK,CH_0610FEM,CH_0610MAL,CH_0610UNK,CH_1115FEM,
CH_1115MAL,CH_1115UNK,CH_1617FEM,CH_1617MAL,CH_1617UNK,CH_BABYCAR,CH_GEN,CH_INTER,CH_SCHL,CH_TOYS,
CHRISTFAM,CNS_MEDINC,CNSUS_PCTA,CNSUS_PCTB,CNSUS_PCTH,CNSUS_PCTI,CNSUS_PCTM,CNSUS_PCTO,CNSUS_PCTP,
CNSUS_PCTW,COL_ANTIQ,COL_ARTS,COL_AVID,COL_COIN,COL_GEN,COL_GROUP,COL_MOVIE,COL_SPORT,COL_STAMP,
COMMCHAR,COMMONLIVG,COMPHOMOFC,COMPUTERS,CONG_DIST,COOK_GEN,COOK_GOUR,COOK_GROUP,COUNTY_ST,COUNTY_TYPE,
CRAFTS,CRD_AMEXGO,CRD_AMEXRG,CRD_DISCGO,CRD_DISCRG,CRD_GASGO,CRD_GASRG,CRD_MASGO,CRD_MASRG,CRD_RANGE,
CREDRATE,CULARTLIV,CURRAFFAIR,DEPTSTCRD,DIETING,DIYLIV,DMA_Code,DOGOWNER,DON_ANML,DON_ARTCUL,
DON_CHARIT,DON_CHILD,DON_ENVIR,DON_ENVWLD,DON_HEALTH,DON_INTAID,DON_OTHER,DON_POLCONS,DON_POLIT,
DON_POLLIB,DON_RELIG,DON_VET,DONATION,DVDVIDEO,DWELLTYPE,EDU_ONLINE,EDUCATION,ELEC_GROUP,
ELEC_HOMOF,ELEC_TVVID,EQUESTRIAN,ETHNIC_INFER,EXER_AERO,EXER_GROUP,EXER_RUN,EXER_WALK,FISHING,
FOOD_WINE,FOODSNAT,FUEL,FUND_POLIT,GAM_BOARD,GAM_CASINO,GAM_COMP,GAM_VID,GAMING,GARDENER,GARDENING,
GASCARDHLD,GENDER_MIX,GENERATION,GOLF,GRANDCHLD,HEALTHBEAU,HEATHMED,HH_NUMGEN,HH_SENIOR,HH_SIZE,
HH_VETERAN,HH_YOUNGAD,HIGHBROW,HIGHENDAPP,HISTMIL,HITECHLIV,HOH_FLAG,HOME_BIZ,HOME_DECOR,
HOME_SEQ,HOMEGARDEN,HOMEIMP,HOMEIMPDIY,HOMEIMPGRP,HOMELIV,HOMEMKTVAL,HOMEOFFICE,HOMEOWNER,
HOMEOWNRNT,HOUSEPLANT,HSPCNTRYCD,HUNTING,HUNTSHOOT,INCOMESTHH,INV_ACTIVE,INV_ESTPRP,INV_FINGRP,
INV_FORGN,
INV_PERSON,
INV_REAL,
INV_STOCKS,
JEWELRY,
LANGUAGE,
LENGTH_RES,
LFST_COLL,
LFST_HOBB,
LIFESTAGE_CLUSTER,
LOANTOVAL,
LUGGAGE,
MAGAZINE,
MAIL_DONOR,
MAILORDBUY,
MAILORDRSP,
MEDHOMEVAL,
MEMBERSHIP,
MILIWEAPN,
MONEYSEEK,
MOTORCYCLE,
MOVEDATE,
MOVMUSGRP,
MRTLSTATUS,
MUS_AVID,
MUS_COLLEC,
MUS_HOMEST,
MUS_INSTR,
MUS_PLAYER,
NASCAR,
NETWORTH,
NUMADLT,
NUMCHILD,
NUMLINCRED,
OCCDETAIL,
OCCDETAIL_DESC,
OCCUPATION,
ONLPUR_IND,
OUTDRGROUP,
PARENTING,
PARTY_CODE,
PARTY_MIX,
PASSPROSVAL,
PERSONS_HH,
PET_OTHER,
PETS,
PHOTOGRAPH,
PHOTOVIDEO,
POOL,
PRESENCHLD,
PREVIOUS_PARTY,
PRFL_2NDAMEND,
PRFL_ACTIVE_MIL,
PRFL_AMZN_PRIME,
PRFL_ANML_RIGHTS,
PRFL_BIDEN_SUPPORT,
PRFL_BLM_SUPPORT,
PRFL_BORDER_SECURITY,
PRFL_CHOICELIFE,
PRFL_CLINTON_SUPPORT,
PRFL_CONSERVATIVE_NEWS,
PRFL_EDUCATION,
PRFL_ENVIRONMENT,
PRFL_EVANGELICAL,
PRFL_FENCE_SITTER,
PRFL_GUN_CONTROL,
PRFL_HEALTHCARE,
PRFL_HEALTHCARE_REFORM,
PRFL_IMMIGRATION_REFORM,
PRFL_INFLUENCER,
PRFL_INSURANCE,
PRFL_LABOR,
PRFL_LGBT_SUPPORT,
PRFL_LIBERAL_NEWS,
PRFL_MARIJUANA_REFORM,
PRFL_MARRIAGE_EQUALITY,
PRFL_METOO_SUPPORT,
PRFL_MIL_SUPPORT,
PRFL_MINWAGE,
PRFL_OBAMA,
PRFL_PERSUADABLE_VOTER,
PRFL_POLITICAL_IDEOLOGY,
PRFL_SANDERS_SUPPORT,
PRFL_TAXES,
PRFL_TEACHERS_UNION,
PRFL_TEAPARTY,
PRFL_TRUMP_SUPPORT,
PRFL_VETERAN,
PROFLIV,
Property_Type,
RD_AUDIO,
RD_FINNEWS,
RD_GEN,
RD_GRP,
RD_RELIG,
RD_SCIFI,
READ_MAG,
REGION,
RELIGINSP,
RELIGION,
SCISPACE,
SCUBADIVER,
SELFIMP,
SEWER,
SEWING,
SEX,
SINGPARENT,
SMOKING,
SNOWSKI,
SPEC_AUTO,
SPEC_BASE,
SPEC_BASK,
SPEC_FOOT,
SPEC_HOCK,
SPEC_SOCC,
SPEC_TVSP,
SPORTGRP,
SPORTLEIS,
SPORTLIV,
ST_LO_HOUS,
ST_UP_HOUS,
b.STATE,
STATECONT,
STATUS,
SWEEPSTAKE,
TELECOM,
TENNIS,
THEATER,
TIMEZONE,
TOD_GOV_D_2012,
TOD_GOV_D_2014,
TOD_GOV_D_2016,
TOD_GOV_D_2018,
TOD_GOV_D_2020,
TOD_GOV_DIFF_2012,
TOD_GOV_DIFF_2014,
TOD_GOV_DIFF_2016,
TOD_GOV_DIFF_2018,
TOD_GOV_DIFF_2020,
TOD_GOV_O_2014,
TOD_GOV_O_2016,
TOD_GOV_O_2018,
TOD_GOV_R_2012,
TOD_GOV_R_2014,
TOD_GOV_R_2016,
TOD_GOV_R_2018,
TOD_GOV_R_2020,
TOD_PRES_D_2012,
TOD_PRES_D_2016,
TOD_PRES_D_2016_PREC,
TOD_PRES_D_2020,
TOD_PRES_D_2020_PREC,
TOD_PRES_DIFF_2012,
TOD_PRES_DIFF_2016,
TOD_PRES_DIFF_2016_PREC,
TOD_PRES_DIFF_2020,
TOD_PRES_DIFF_2020_PREC,
TOD_PRES_O_2012,
TOD_PRES_O_2016,
TOD_PRES_O_2016_PREC,
TOD_PRES_O_2020,
TOD_PRES_O_2020_PREC,
TOD_PRES_R_2012,
TOD_PRES_R_2016,
TOD_PRES_R_2016_PREC,
TOD_PRES_R_2020,
TOD_PRES_R_2020_PREC,
TOD_SEN_D_2012,
TOD_SEN_D_2014,
TOD_SEN_D_2016,
TOD_SEN_D_2018,
TOD_SEN_D_2020,
TOD_SEN_DIFF_2012,
TOD_SEN_DIFF_2014,
TOD_SEN_DIFF_2016,
TOD_SEN_DIFF_2018,
TOD_SEN_DIFF_2020,
TOD_SEN_O_2012,
TOD_SEN_O_2014,
TOD_SEN_O_2016,
TOD_SEN_O_2018,
TOD_SEN_O_2020,
TOD_SEN_R_2012,
TOD_SEN_R_2014,
TOD_SEN_R_2016,
TOD_SEN_R_2018,
TOD_SEN_R_2020,
TRAIL_CNT,
TRAVEL,
TRV_CRDHLD,
TRV_CRUISE,
TRV_DOMES,
TRV_INTL,
TRVLGROUP,
TV_CABLE,
TV_SAT,
UPSCALLIVE,
VALGENMER,
VISAGOLD,
VISAREGULR,
VOT_PREF,
VOTER_CNT,
VOTER_TRLR,
VP_GEN,
VP_OTH,
VP_PPP,
VP_PRI,
VTR_GEN00,
VTR_GEN01,
VTR_GEN02,
VTR_GEN03,
VTR_GEN04,
VTR_GEN05,
VTR_GEN06,
VTR_GEN07,
VTR_GEN08,
VTR_GEN09,
VTR_GEN10,
VTR_GEN11,
VTR_GEN12,
VTR_GEN13,
VTR_GEN14,
VTR_GEN15,
VTR_GEN16,
VTR_GEN17,
VTR_GEN18,
VTR_GEN19,
VTR_GEN20,
VTR_GEN21,
VTR_GEN22,
VTR_GEN23,
VTR_GEN24,
VTR_GEN84,
VTR_GEN85,
VTR_GEN86,
VTR_GEN87,
VTR_GEN88,
VTR_GEN89,
VTR_GEN90,
VTR_GEN91,
VTR_GEN92,
VTR_GEN93,
VTR_GEN94,
VTR_GEN95,
VTR_GEN96,
VTR_GEN97,
VTR_GEN98,
VTR_GEN99,
VTR_OTH00,
VTR_OTH01,
VTR_OTH02,
VTR_OTH03,
VTR_OTH04,
VTR_OTH05,
VTR_OTH06,
VTR_OTH07,
VTR_OTH08,
VTR_OTH09,
VTR_OTH10,
VTR_OTH11,
VTR_OTH12,
VTR_OTH13,
VTR_OTH14,
VTR_OTH15,
VTR_OTH16,
VTR_OTH17,
VTR_OTH18,
VTR_OTH19,
VTR_OTH20,
VTR_OTH21,
VTR_OTH22,
VTR_OTH23,
VTR_OTH24,
VTR_OTH84,
VTR_OTH85,
VTR_OTH86,
VTR_OTH87,
VTR_OTH88,
VTR_OTH89,
VTR_OTH90,
VTR_OTH91,
VTR_OTH92,
VTR_OTH93,
VTR_OTH94,
VTR_OTH95,
VTR_OTH96,
VTR_OTH97,
VTR_OTH98,
VTR_OTH99,
VTR_PPP00,
VTR_PPP04,
VTR_PPP08,
VTR_PPP12,
VTR_PPP16,
VTR_PPP20,
VTR_PPP24,
VTR_PPP84,
VTR_PPP88,
VTR_PPP92,
VTR_PPP96,
VTR_PRI00,
VTR_PRI01,
VTR_PRI02,
VTR_PRI03,
VTR_PRI04,
VTR_PRI05,
VTR_PRI06,
VTR_PRI07,
VTR_PRI08,
VTR_PRI09,
VTR_PRI10,
VTR_PRI11,
VTR_PRI12,
VTR_PRI13,
VTR_PRI14,
VTR_PRI15,
VTR_PRI16,
VTR_PRI17,
VTR_PRI18,
VTR_PRI19,
VTR_PRI20,
VTR_PRI21,
VTR_PRI22,
VTR_PRI23,
VTR_PRI24,
VTR_PRI84,
VTR_PRI85,
VTR_PRI86,
VTR_PRI87,
VTR_PRI88,
VTR_PRI89,
VTR_PRI90,
VTR_PRI91,
VTR_PRI92,
VTR_PRI93,
VTR_PRI94,
VTR_PRI95,
VTR_PRI96,
VTR_PRI97,
VTR_PRI98,
VTR_PRI99,
WATER,
WEALTH,
WOODWORK,
WORKWOMAN,
YEARBUILT,
b.ZIP	from predictitdata_20240205_for_matching a join '+@state+'_voters..'+@state+'_voters b with (nolock)
on a.firstname = b.firstname and a.lastname = b.lastname and a.zip = b.mzip and a.zip4 = b.m_zip4
where a.zip4 >'''' and a.rowid not in (select rowid from predictit_voter_match with (nolock))'
exec(@sqlstring)
fetch next from c1 into @state
end 
close c1
deallocate c1
--2 minutes


delete from predictit_voter_match where zip =''--(56 rows affected)
select count(*) from  predictit_voter_match --140670
select count(distinct rowid) from predictit_voter_match --137397

alter table predictit_voter_match add idnum int identity(1,1)
alter table predictit_voter_match drop column idnum

--going to  keep only the records with 1 match
select a.* into predictit_voter_matched from predictit_voter_match a
where rowid in (select rowid from  predictit_voter_match group by rowid having count(*) =1 )
--(134176 rows affected)

select state, count(*) from  predictit_voter_matched group by state
order by count(*) desc


select * from predictitdata_20240205_for_matching


select  deposits,
accountbalance,
Withdrawals,
Invested,
numshares,
riskamount,
profit,
loss,
lastlogin, b.* 
into predictit_matched_20240206
from predictitdata_20240205_for_matching a join predictit_voter_matched b on a.rowid = b.rowid
--(134176 rows affected)

select party_code, count(*) from predictit_matched_20240206
group by party_code


select count(*) from predictit_matched_20240206 --134176
where deposits = '0.000000' and accountbalance = '0.000000' and withdrawals = '0.00'
and invested = '0.00' and numshares = '0' and riskamount = '0.0000' and profit = '0.000000'
and loss = '0.000000' --45097 probably going to end up getting rid of these ppl as being inactive / never having used the system.

print 134176-45097 --89079 this will probably be the # of records we will work with.

-- pull a random voter sample to use for comparison 
select top 0 api_id into voter_sample_tmp from ak_voters with (nolock)

declare @state varchar(2)
declare @sqlstring varchar(8000)
declare @state_total int
declare @numpull int
DECLARE @sql NVARCHAR(MAX)
DECLARE @count INT
DECLARE @paramDef NVARCHAR(500)

declare c1 cursor for select distinct state from prod_dates 
order by state
open c1
fetch next from c1 into @state

while @@fetch_status = 0

begin

-- Construct the SQL
SET @sql = N'SELECT @count = COUNT(*) FROM ' +@state+'_voters..'+@state+'_voters'

-- Parameter definition
SET @paramDef = N'@count INT OUTPUT'

-- Execute the dynamic SQL
EXEC sp_executesql @sql, @paramDef, @count=@count OUTPUT

SET @numpull = ROUND(@count * 0.10, 0)

select @sqlstring = 'insert into voter_sample_tmp
select top  '+cast(@numpull as varchar)+ 'api_id
from '+@state+'_voters..'+@state+'_voters with (nolock)
where supress_flag = '''' and state = '''+@state+''' order by newid()'
exec(@sqlstring)

fetch next from c1 into @state
end
close c1
deallocate c1

select top 100000  * into voter_sample_tmp_100k from voter_sample_tmp order by newid()
--(100000 rows affected)



select top 0 * into voter_sample_100k from predictit_matched_20240206

sp_columns voter_sample_100k

alter table voter_sample_100k drop column 
deposits,
accountbalance,
Withdrawals,
Invested,
numshares,
riskamount,
profit,
loss,
lastlogin,
rowid

--rerunning KS . has some weird values in ST_LO_HOUS that caused truncation.
alter table voter_sample_100k alter column ST_LO_HOUS varchar(13)

declare @state varchar(2)
declare @sqlstring varchar(8000)

declare c1 cursor for select distinct state from prod_dates with (nolock) 
where state = 'ks'
order by state
open c1
fetch next from c1 into @state

while @@fetch_status = 0

begin

select @sqlstring = 'insert into voter_sample_100k
select ABSENTEE,AD_1824FEM,AD_1824MAL,AD_1824UNK,AD_2534FEM,AD_2534MAL,AD_2534UNK,
AD_3544FEM,AD_3544MAL,AD_3544UNK,AD_4554FEM,AD_4554MAL,AD_4554UNK,AD_5564FEM,AD_5564MAL,
AD_5564UNK,AD_6574FEM,AD_6574MAL,AD_6574UNK,AD_75UPFEM,AD_75UPMAL,AD_75UPUNK,AFAMPROFLS,
AGE,AGE_IND,AI_County_Name,AIRCOND,ALUMNI_INDUSTRY,ALUMNI_SALARY_EST,APP_CHILD,APP_MENBIG,
APP_MENS,APP_TODDLR,APP_WOMEN,APP_WOMENS,APP_WOMPET,APP_WOMPLS,APP_YNGMEN,ART_ANTIQ,ART_ART,
ARTS,ASSMLCODE,AUTO_BODY,AUTO_COUNT,AUTO_COUNTRY,AUTO_ECO,AUTO_FUEL_TYPE,AUTO_IMPORT_DOMESTIC,
AUTO_LUXURY,AUTO_MAKE,AUTO_MODEL,AUTO_MSRP,AUTO_TRANS_TYPE,AUTO_TYPE,AUTO_YEAR,AUTOACCES,AUTOWORK,
AVIATION,BEAUTY,BKSMAG_BKS,BKSMAG_MAG,BKSMS_AUD,BNKCRD_HH,BNKCRD_HLD,BOATING,BROADERLIV,BUS_OWNER,
CAMPHIKING,CARD_PREM,CARD_UNK,CARDUSER,CAREER,CAREERIMP,CATOWNER,CENSUS_BLK,CENSUS_ST,CH_0002FEM,
CH_0002MAL,CH_0002UNK,CH_0305FEM,CH_0305MAL,CH_0305UNK,CH_0610FEM,CH_0610MAL,CH_0610UNK,CH_1115FEM,
CH_1115MAL,CH_1115UNK,CH_1617FEM,CH_1617MAL,CH_1617UNK,CH_BABYCAR,CH_GEN,CH_INTER,CH_SCHL,CH_TOYS,
CHRISTFAM,CNS_MEDINC,CNSUS_PCTA,CNSUS_PCTB,CNSUS_PCTH,CNSUS_PCTI,CNSUS_PCTM,CNSUS_PCTO,CNSUS_PCTP,
CNSUS_PCTW,COL_ANTIQ,COL_ARTS,COL_AVID,COL_COIN,COL_GEN,COL_GROUP,COL_MOVIE,COL_SPORT,COL_STAMP,
COMMCHAR,COMMONLIVG,COMPHOMOFC,COMPUTERS,CONG_DIST,COOK_GEN,COOK_GOUR,COOK_GROUP,COUNTY_ST,COUNTY_TYPE,
CRAFTS,CRD_AMEXGO,CRD_AMEXRG,CRD_DISCGO,CRD_DISCRG,CRD_GASGO,CRD_GASRG,CRD_MASGO,CRD_MASRG,CRD_RANGE,
CREDRATE,CULARTLIV,CURRAFFAIR,DEPTSTCRD,DIETING,DIYLIV,DMA_Code,DOGOWNER,DON_ANML,DON_ARTCUL,
DON_CHARIT,DON_CHILD,DON_ENVIR,DON_ENVWLD,DON_HEALTH,DON_INTAID,DON_OTHER,DON_POLCONS,DON_POLIT,
DON_POLLIB,DON_RELIG,DON_VET,DONATION,DVDVIDEO,DWELLTYPE,EDU_ONLINE,EDUCATION,ELEC_GROUP,
ELEC_HOMOF,ELEC_TVVID,EQUESTRIAN,ETHNIC_INFER,EXER_AERO,EXER_GROUP,EXER_RUN,EXER_WALK,FISHING,
FOOD_WINE,FOODSNAT,FUEL,FUND_POLIT,GAM_BOARD,GAM_CASINO,GAM_COMP,GAM_VID,GAMING,GARDENER,GARDENING,
GASCARDHLD,GENDER_MIX,GENERATION,GOLF,GRANDCHLD,HEALTHBEAU,HEATHMED,HH_NUMGEN,HH_SENIOR,HH_SIZE,
HH_VETERAN,HH_YOUNGAD,HIGHBROW,HIGHENDAPP,HISTMIL,HITECHLIV,HOH_FLAG,HOME_BIZ,HOME_DECOR,
HOME_SEQ,HOMEGARDEN,HOMEIMP,HOMEIMPDIY,HOMEIMPGRP,HOMELIV,HOMEMKTVAL,HOMEOFFICE,HOMEOWNER,
HOMEOWNRNT,HOUSEPLANT,HSPCNTRYCD,HUNTING,HUNTSHOOT,INCOMESTHH,INV_ACTIVE,INV_ESTPRP,INV_FINGRP,
INV_FORGN,
INV_PERSON,
INV_REAL,
INV_STOCKS,
JEWELRY,
LANGUAGE,
LENGTH_RES,
LFST_COLL,
LFST_HOBB,
LIFESTAGE_CLUSTER,
LOANTOVAL,
LUGGAGE,
MAGAZINE,
MAIL_DONOR,
MAILORDBUY,
MAILORDRSP,
MEDHOMEVAL,
MEMBERSHIP,
MILIWEAPN,
MONEYSEEK,
MOTORCYCLE,
MOVMUSGRP,
MRTLSTATUS,
MUS_AVID,
MUS_COLLEC,
MUS_HOMEST,
MUS_INSTR,
MUS_PLAYER,
NASCAR,
NETWORTH,
NUMADLT,
NUMCHILD,
NUMLINCRED,
OCCDETAIL,
OCCDETAIL_DESC,
OCCUPATION,
ONLPUR_IND,
OUTDRGROUP,
PARENTING,
PARTY_CODE,
PARTY_MIX,
PASSPROSVAL,
PERSONS_HH,
PET_OTHER,
PETS,
PHOTOGRAPH,
PHOTOVIDEO,
POOL,
PRESENCHLD,
PREVIOUS_PARTY,
PRFL_2NDAMEND,
PRFL_ACTIVE_MIL,
PRFL_AMZN_PRIME,
PRFL_ANML_RIGHTS,
PRFL_BIDEN_SUPPORT,
PRFL_BLM_SUPPORT,
PRFL_BORDER_SECURITY,
PRFL_CHOICELIFE,
PRFL_CLINTON_SUPPORT,
PRFL_CONSERVATIVE_NEWS,
PRFL_EDUCATION,
PRFL_ENVIRONMENT,
PRFL_EVANGELICAL,
PRFL_FENCE_SITTER,
PRFL_GUN_CONTROL,
PRFL_HEALTHCARE,
PRFL_HEALTHCARE_REFORM,
PRFL_IMMIGRATION_REFORM,
PRFL_INFLUENCER,
PRFL_INSURANCE,
PRFL_LABOR,
PRFL_LGBT_SUPPORT,
PRFL_LIBERAL_NEWS,
PRFL_MARIJUANA_REFORM,
PRFL_MARRIAGE_EQUALITY,
PRFL_METOO_SUPPORT,
PRFL_MIL_SUPPORT,
PRFL_MINWAGE,
PRFL_OBAMA,
PRFL_PERSUADABLE_VOTER,
PRFL_POLITICAL_IDEOLOGY,
PRFL_SANDERS_SUPPORT,
PRFL_TAXES,
PRFL_TEACHERS_UNION,
PRFL_TEAPARTY,
PRFL_TRUMP_SUPPORT,
PRFL_VETERAN,
PROFLIV,
Property_Type,
RD_AUDIO,
RD_FINNEWS,
RD_GEN,
RD_GRP,
RD_RELIG,
RD_SCIFI,
READ_MAG,
REGION,
RELIGINSP,
RELIGION,
SCISPACE,
SCUBADIVER,
SELFIMP,
SEWER,
SEWING,
SEX,
SINGPARENT,
SMOKING,
SNOWSKI,
SPEC_AUTO,
SPEC_BASE,
SPEC_BASK,
SPEC_FOOT,
SPEC_HOCK,
SPEC_SOCC,
SPEC_TVSP,
SPORTGRP,
SPORTLEIS,
SPORTLIV,
ST_LO_HOUS,
ST_UP_HOUS,
b.STATE,
STATECONT,
STATUS,
SWEEPSTAKE,
TELECOM,
TENNIS,
THEATER,
TIMEZONE,
TOD_GOV_D_2012,
TOD_GOV_D_2014,
TOD_GOV_D_2016,
TOD_GOV_D_2018,
TOD_GOV_D_2020,
TOD_GOV_DIFF_2012,
TOD_GOV_DIFF_2014,
TOD_GOV_DIFF_2016,
TOD_GOV_DIFF_2018,
TOD_GOV_DIFF_2020,
TOD_GOV_O_2014,
TOD_GOV_O_2016,
TOD_GOV_O_2018,
TOD_GOV_R_2012,
TOD_GOV_R_2014,
TOD_GOV_R_2016,
TOD_GOV_R_2018,
TOD_GOV_R_2020,
TOD_PRES_D_2012,
TOD_PRES_D_2016,
TOD_PRES_D_2016_PREC,
TOD_PRES_D_2020,
TOD_PRES_D_2020_PREC,
TOD_PRES_DIFF_2012,
TOD_PRES_DIFF_2016,
TOD_PRES_DIFF_2016_PREC,
TOD_PRES_DIFF_2020,
TOD_PRES_DIFF_2020_PREC,
TOD_PRES_O_2012,
TOD_PRES_O_2016,
TOD_PRES_O_2016_PREC,
TOD_PRES_O_2020,
TOD_PRES_O_2020_PREC,
TOD_PRES_R_2012,
TOD_PRES_R_2016,
TOD_PRES_R_2016_PREC,
TOD_PRES_R_2020,
TOD_PRES_R_2020_PREC,
TOD_SEN_D_2012,
TOD_SEN_D_2014,
TOD_SEN_D_2016,
TOD_SEN_D_2018,
TOD_SEN_D_2020,
TOD_SEN_DIFF_2012,
TOD_SEN_DIFF_2014,
TOD_SEN_DIFF_2016,
TOD_SEN_DIFF_2018,
TOD_SEN_DIFF_2020,
TOD_SEN_O_2012,
TOD_SEN_O_2014,
TOD_SEN_O_2016,
TOD_SEN_O_2018,
TOD_SEN_O_2020,
TOD_SEN_R_2012,
TOD_SEN_R_2014,
TOD_SEN_R_2016,
TOD_SEN_R_2018,
TOD_SEN_R_2020,
TRAIL_CNT,
TRAVEL,
TRV_CRDHLD,
TRV_CRUISE,
TRV_DOMES,
TRV_INTL,
TRVLGROUP,
TV_CABLE,
TV_SAT,
UPSCALLIVE,
VALGENMER,
VISAGOLD,
VISAREGULR,
VOT_PREF,
VOTER_CNT,
VOTER_TRLR,
VP_GEN,
VP_OTH,
VP_PPP,
VP_PRI,
VTR_GEN00,
VTR_GEN01,
VTR_GEN02,
VTR_GEN03,
VTR_GEN04,
VTR_GEN05,
VTR_GEN06,
VTR_GEN07,
VTR_GEN08,
VTR_GEN09,
VTR_GEN10,
VTR_GEN11,
VTR_GEN12,
VTR_GEN13,
VTR_GEN14,
VTR_GEN15,
VTR_GEN16,
VTR_GEN17,
VTR_GEN18,
VTR_GEN19,
VTR_GEN20,
VTR_GEN21,
VTR_GEN22,
VTR_GEN23,
VTR_GEN24,
VTR_GEN84,
VTR_GEN85,
VTR_GEN86,
VTR_GEN87,
VTR_GEN88,
VTR_GEN89,
VTR_GEN90,
VTR_GEN91,
VTR_GEN92,
VTR_GEN93,
VTR_GEN94,
VTR_GEN95,
VTR_GEN96,
VTR_GEN97,
VTR_GEN98,
VTR_GEN99,
VTR_OTH00,
VTR_OTH01,
VTR_OTH02,
VTR_OTH03,
VTR_OTH04,
VTR_OTH05,
VTR_OTH06,
VTR_OTH07,
VTR_OTH08,
VTR_OTH09,
VTR_OTH10,
VTR_OTH11,
VTR_OTH12,
VTR_OTH13,
VTR_OTH14,
VTR_OTH15,
VTR_OTH16,
VTR_OTH17,
VTR_OTH18,
VTR_OTH19,
VTR_OTH20,
VTR_OTH21,
VTR_OTH22,
VTR_OTH23,
VTR_OTH24,
VTR_OTH84,
VTR_OTH85,
VTR_OTH86,
VTR_OTH87,
VTR_OTH88,
VTR_OTH89,
VTR_OTH90,
VTR_OTH91,
VTR_OTH92,
VTR_OTH93,
VTR_OTH94,
VTR_OTH95,
VTR_OTH96,
VTR_OTH97,
VTR_OTH98,
VTR_OTH99,
VTR_PPP00,
VTR_PPP04,
VTR_PPP08,
VTR_PPP12,
VTR_PPP16,
VTR_PPP20,
VTR_PPP24,
VTR_PPP84,
VTR_PPP88,
VTR_PPP92,
VTR_PPP96,
VTR_PRI00,
VTR_PRI01,
VTR_PRI02,
VTR_PRI03,
VTR_PRI04,
VTR_PRI05,
VTR_PRI06,
VTR_PRI07,
VTR_PRI08,
VTR_PRI09,
VTR_PRI10,
VTR_PRI11,
VTR_PRI12,
VTR_PRI13,
VTR_PRI14,
VTR_PRI15,
VTR_PRI16,
VTR_PRI17,
VTR_PRI18,
VTR_PRI19,
VTR_PRI20,
VTR_PRI21,
VTR_PRI22,
VTR_PRI23,
VTR_PRI24,
VTR_PRI84,
VTR_PRI85,
VTR_PRI86,
VTR_PRI87,
VTR_PRI88,
VTR_PRI89,
VTR_PRI90,
VTR_PRI91,
VTR_PRI92,
VTR_PRI93,
VTR_PRI94,
VTR_PRI95,
VTR_PRI96,
VTR_PRI97,
VTR_PRI98,
VTR_PRI99,
WATER,
WEALTH,
WOODWORK,
WORKWOMAN,
YEARBUILT,
b.ZIP	from '+@state+'_voters..'+@state+'_voters b with (nolock)
where api_id in (select api_id from voter_sample_tmp_100k )'
exec(@sqlstring)
fetch next from c1 into @state
end 
close c1
deallocate c1


select count(*) from voter_sample_100k --100000

select state, count(*) from voter_sample_100k
group by state order by count(*) desc

--tables to use voter_sample_100k , predictit_matched_20240206